<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>Trang chủ - Cửa hàng điện thoại</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/home.css}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <!-- Header fragment -->
    <div th:replace="fragments :: headerFragment"></div>

    <!-- Main content wrapper -->
    <div class="main-content">
        <!-- Banner -->
        <div id="carouselBanner" class="carousel slide mb-5 rounded shadow-sm" data-bs-ride="carousel" data-bs-interval="4000">
            <div class="carousel-inner rounded">
                <div class="carousel-item active">
                    <img src="https://cdn-media.sforum.vn/storage/app/media/wp-content/uploads/2021/11/Cover-10.jpg"
                         class="d-block w-100 banner-img" alt="Banner 1"/>
                    <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                        <h3>Chào mừng đến với MHC Digital</h3>
                        <p>Khuyến mãi lớn dịp hè, mua ngay kẻo lỡ!</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="https://cdn.tgdd.vn/hoi-dap/1355217/banner-tgdd-800x300.jpg" class="d-block w-100 banner-img"
                         alt="Banner 2"/>
                    <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                        <h3>Sản phẩm mới nhất - Giá hấp dẫn</h3>
                        <p>Tận hưởng trải nghiệm công nghệ đỉnh cao</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselBanner" data-bs-slide="prev">
                <span class="carousel-control-prev-icon shadow rounded-circle"></span>
                <span class="visually-hidden">Trước</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselBanner" data-bs-slide="next">
                <span class="carousel-control-next-icon shadow rounded-circle"></span>
                <span class="visually-hidden">Sau</span>
            </button>
        </div>

        <!-- Giới thiệu nhanh -->
        <section class="mb-5 text-center">
            <h2 class="mb-4 fw-bold text-primary">Tại sao chọn chúng tôi?</h2>
            <div class="row row-cols-1 row-cols-md-3 g-4">
                <div class="col">
                    <div class="card border-0 h-100">
                        <div class="card-body">
                            <i class="fa-solid fa-truck-fast feature-icon mb-3 d-block mx-auto text-primary fs-1"></i>
                            <h5 class="card-title fw-semibold">Giao hàng nhanh</h5>
                            <p class="card-text text-muted">Đảm bảo giao hàng trong vòng 24 giờ với dịch vụ chuyên nghiệp.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-0 h-100">
                        <div class="card-body">
                            <i class="fa-solid fa-shield-halved feature-icon mb-3 d-block mx-auto text-primary fs-1"></i>
                            <h5 class="card-title fw-semibold">Bảo hành chính hãng</h5>
                            <p class="card-text text-muted">Chính sách bảo hành uy tín, đổi trả dễ dàng trong 7 ngày.</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card border-0 h-100">
                        <div class="card-body">
                            <i class="fa-solid fa-phone-volume feature-icon mb-3 d-block mx-auto text-primary fs-1"></i>
                            <h5 class="card-title fw-semibold">Hỗ trợ 24/7</h5>
                            <p class="card-text text-muted">Đội ngũ tư vấn nhiệt tình, hỗ trợ khách hàng mọi lúc mọi nơi.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sản phẩm nổi bật -->
        <section class="mb-5">
            <h2 class="mb-4 fw-bold text-primary text-center">Sản phẩm nổi bật</h2>
            <div class="row" th:if="${not #lists.isEmpty(top5BestSellingProducts)}">
                <div class="col-md-6 col-lg-4 mb-4" th:each="item : ${top5BestSellingProducts}">
                    <div class="card product-card h-100 shadow-sm border-0 rounded">
                        <img th:src="@{'/images/' + ${item.product.imageUrl}}" class="card-img-top rounded-top product-image" alt="Ảnh sản phẩm"/>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title fw-semibold" th:text="${item.product.name}"></h5>
                            <div class="product-price d-flex flex-column mb-3">
                                <!-- Nếu hết hàng -->
                                <span th:if="${item.product.stock == 0}" class="text-danger fw-bold">Hết hàng</span>

                                <!-- Nếu còn hàng -->
                                <div th:if="${item.product.stock > 0}">
                                    <!-- Giá gạch ngang nếu có giảm giá -->
                                    <span th:if="${item.product.discountPercent != null and item.product.discountPercent > 0}"
                                          class="price-original text-muted text-decoration-line-through"
                                          th:text="${#numbers.formatDecimal(item.product.price, 0, 'POINT', 0, 'COMMA')} + ' VND'"></span>

                                    <!-- Giá sau khi giảm + badge giảm giá -->
                                    <div class="d-flex align-items-center gap-2">
                                <span class="price-discounted fw-bold text-danger fs-5"
                                      th:text="${#numbers.formatDecimal(item.product.priceAfterDiscount, 0, 'POINT', 0, 'COMMA')} + ' VND'"></span>
                                        <span th:if="${item.product.discountPercent != null and item.product.discountPercent > 0}"
                                              class="badge bg-danger"
                                              th:text="'-' + ${item.product.discountPercent} + '%'"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-auto d-grid gap-2">
                                <!-- Nút Xem chi tiết -->
                                <a th:href="@{/product-detail/{id}(id=${item.product.id})}"
                                   class="btn btn-outline-primary btn-sm w-100 text-center">
                                    Xem chi tiết
                                </a>

                                <!-- Nút Thêm vào giỏ hàng chỉ hiển thị khi đã đăng nhập -->
                                <form th:if="${#authorization.expression('isAuthenticated()') and item.product.stock > 0}"
                                      th:action="@{/cart/add}"
                                      method="post"
                                      class="w-100">
                                    <input type="hidden" name="productId" th:value="${item.product.id}" />
                                    <input type="hidden" name="quantity" value="1" />
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <button type="submit" class="btn btn-success btn-sm fw-semibold w-100">
                                        <i class="fa-solid fa-cart-plus me-1"></i> Thêm vào giỏ hàng
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <p th:if="${#lists.isEmpty(top5BestSellingProducts)}" class="text-center text-danger fw-bold fs-5 mt-5">
                Chưa có sản phẩm nổi bật.
            </p>
        </section>

        <!-- Xem tất cả sản phẩm -->
        <div class="text-center mb-5">
            <a href="/products" class="btn btn-lg btn-primary fw-semibold">
                <i class="fa-solid fa-mobile-screen-button me-2"></i> Xem tất cả sản phẩm
            </a>
        </div>
    </div>

    <!-- Footer fragment -->
    <div th:replace="fragments :: footerFragment"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
