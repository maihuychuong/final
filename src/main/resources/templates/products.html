<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>S·∫£n ph·∫©m - C·ª≠a h√†ng ƒëi·ªán tho·∫°i</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/home.css}"/>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
</head>
<body>
<div th:if="${errorMessage}" class="alert alert-danger text-center" th:text="${errorMessage}"></div>
<div th:if="${successMessage}" class="alert alert-success text-center" th:text="${successMessage}"></div>

<div class="container py-4">
    <!-- Header fragment -->
    <div th:replace="fragments :: headerFragment"></div>

    <!-- Main content wrapper -->
    <div class="main-content">
        <div class="row">
            <!-- Sidebar l·ªçc -->
            <aside class="col-lg-3 col-md-4 mb-5">
                <form method="get" action="/products" class="p-4 bg-white rounded shadow-sm border">
                    <h5 class="mb-3 fw-bold text-primary border-bottom pb-2">üîç T√¨m ki·∫øm s·∫£n ph·∫©m</h5>
                    <input type="text" name="keyword" class="form-control mb-4" placeholder="Nh·∫≠p t·ª´ kh√≥a..."
                           th:value="${keyword}" />

                    <h6 class="fw-semibold text-secondary mb-2">üí∞ Kho·∫£ng gi√°</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="priceRange" value="0-5000000" id="price1"
                               th:checked="${priceRange == '0-5000000'}" />
                        <label class="form-check-label" for="price1">D∆∞·ªõi 5 tri·ªáu</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="priceRange" value="5000000-10000000" id="price2"
                               th:checked="${priceRange == '5000000-10000000'}" />
                        <label class="form-check-label" for="price2">5 - 10 tri·ªáu</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="priceRange" value="10000000-20000000" id="price3"
                               th:checked="${priceRange == '10000000-20000000'}" />
                        <label class="form-check-label" for="price3">10 - 20 tri·ªáu</label>
                    </div>
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="radio" name="priceRange" value="20000000-999999999" id="price4"
                               th:checked="${priceRange == '20000000-999999999'}" />
                        <label class="form-check-label" for="price4">Tr√™n 20 tri·ªáu</label>
                    </div>

                    <h6 class="fw-semibold text-secondary mb-2">üîñ Gi·∫£m gi√°</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="discount" value="all" id="discountAll"
                               th:checked="${discount == null or discount == 'all'}" />
                        <label class="form-check-label" for="discountAll">T·∫•t c·∫£</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="discount" value="yes" id="discountYes"
                               th:checked="${discount == 'yes'}" />
                        <label class="form-check-label" for="discountYes">C√≥ gi·∫£m gi√°</label>
                    </div>
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="radio" name="discount" value="no" id="discountNo"
                               th:checked="${discount == 'no'}" />
                        <label class="form-check-label" for="discountNo">Kh√¥ng gi·∫£m gi√°</label>
                    </div>

                    <h6 class="fw-semibold text-secondary mb-2">üì¶ T√¨nh tr·∫°ng h√†ng</h6>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="stockStatus" value="all" id="stockAll"
                               th:checked="${stockStatus == null or stockStatus == 'all'}" />
                        <label class="form-check-label" for="stockAll">T·∫•t c·∫£</label>
                    </div>
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="stockStatus" value="inStock" id="stockIn"
                               th:checked="${stockStatus == 'inStock'}" />
                        <label class="form-check-label" for="stockIn">C√≤n h√†ng</label>
                    </div>
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="radio" name="stockStatus" value="outOfStock" id="stockOut"
                               th:checked="${stockStatus == 'outOfStock'}" />
                        <label class="form-check-label" for="stockOut">H·∫øt h√†ng</label>
                    </div>

                    <h6 class="fw-semibold text-secondary mb-2">üè∑Ô∏è H√£ng s·∫£n xu·∫•t</h6>
                    <div th:each="brand : ${allBrands}" class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" name="brands" th:value="${brand}"
                               th:id="${'brand-' + brand}"
                               th:checked="${#lists.contains(brands, brand)}" />
                        <label class="form-check-label" th:for="${'brand-' + brand}" th:text="${brand}"></label>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-grow-1 fw-semibold">L·ªçc s·∫£n ph·∫©m</button>
                        <a href="/products" class="btn btn-outline-secondary flex-grow-1 fw-semibold">X√≥a b·ªô l·ªçc</a>
                    </div>
                </form>
            </aside>

            <!-- Danh s√°ch s·∫£n ph·∫©m -->
            <section class="col-lg-9 col-md-8">
                <div class="row" th:if="${not #lists.isEmpty(products)}">
                    <div class="col-md-6 col-lg-4 mb-4" th:each="product : ${products}">
                        <div class="card product-card h-100 shadow-sm border-0 rounded">
                            <img th:src="@{'/images/' + ${product.imageUrl}}" class="card-img-top rounded-top product-image" alt="·∫¢nh s·∫£n ph·∫©m"/>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title fw-semibold" th:text="${product.name}"></h5>
                                <div class="product-price d-flex flex-column mb-3">
                                    <!-- N·∫øu h·∫øt h√†ng -->
                                    <span th:if="${product.stock == 0}" class="text-danger fw-bold">H·∫øt h√†ng</span>

                                    <!-- N·∫øu c√≤n h√†ng -->
                                    <div th:if="${product.stock > 0}">
                                        <!-- Gi√° g·∫°ch ngang n·∫øu c√≥ gi·∫£m gi√° -->
                                        <span th:if="${product.discountPercent != null and product.discountPercent > 0}"
                                              class="price-original text-muted text-decoration-line-through"
                                              th:text="${#numbers.formatDecimal(product.price, 0, 'POINT', 0, 'COMMA')} + ' VND'"></span>

                                        <!-- Gi√° sau khi gi·∫£m + badge gi·∫£m gi√° -->
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="price-discounted fw-bold text-danger fs-5"
                                                  th:text="${#numbers.formatDecimal(product.priceAfterDiscount, 0, 'POINT', 0, 'COMMA')} + ' VND'"></span>
                                            <span th:if="${product.discountPercent != null and product.discountPercent > 0}"
                                                  class="badge bg-danger"
                                                  th:text="'-' + ${product.discountPercent} + '%'"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-auto d-grid gap-2">
                                    <!-- N√∫t Xem chi ti·∫øt -->
                                    <a th:href="@{/product-detail/{id}(id=${product.id})}"
                                       class="btn btn-outline-primary btn-sm w-100 text-center">
                                        Xem chi ti·∫øt
                                    </a>

                                    <!-- N√∫t Th√™m v√†o gi·ªè h√†ng ch·ªâ hi·ªÉn th·ªã khi ƒë√£ ƒëƒÉng nh·∫≠p -->
                                    <form th:if="${#authorization.expression('isAuthenticated()') and product.stock > 0}"
                                          th:action="@{/cart/add}"
                                          method="post"
                                          class="w-100">
                                        <input type="hidden" name="productId" th:value="${product.id}" />
                                        <input type="hidden" name="quantity" value="1" />
                                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                        <button type="submit" class="btn btn-success btn-sm fw-semibold w-100">
                                            <i class="fa-solid fa-cart-plus me-1"></i> Th√™m v√†o gi·ªè h√†ng
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <p th:if="${#lists.isEmpty(products)}" class="text-center text-danger fw-bold fs-5 mt-5">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o.</p>

                <!-- Ph√¢n trang -->
                <nav th:if="${totalPages > 1}" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:if="${currentPage > 1}">
                            <a class="page-link"
                               th:href="@{/products(page=${currentPage - 1}, keyword=${keyword}, priceRange=${priceRange}, brands=${brands})}">¬´</a>
                        </li>
                        <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link"
                               th:href="@{/products(page=${i}, keyword=${keyword}, priceRange=${priceRange}, brands=${brands})}"
                               th:text="${i}">1</a>
                        </li>
                        <li class="page-item" th:if="${currentPage < totalPages}">
                            <a class="page-link"
                               th:href="@{/products(page=${currentPage + 1}, keyword=${keyword}, priceRange=${priceRange}, brands=${brands})}">¬ª</a>
                        </li>
                    </ul>
                </nav>
            </section>
        </div>
    </div>

    <!-- Footer fragment -->
    <div th:replace="fragments :: footerFragment"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
